<head>
<link rel="stylesheet" type="text/css" href="main.css" />
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />

<!-- <link rel="stylesheet" type="text/css" href="./css/custom-theme/jquery-ui-1.9.2.custom.css"> -->
<link rel="stylesheet" type="text/css" href="./css/jquery-ui.css">

<script src="./dist/jquery-ui.js"></script>
<script src="./dist/leaflet.SliderControl.min.js"></script>
<script src="./dist/bouncemarker.js"></script>


<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css" integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.0.0/lodash.min.js"></script>

</head>

<body>
<div id="splashscreen">
	    <h2>Test splashscreen</h2>

	    <a href="#" class="btn enter_link" id="btn-splash">Investigate Further</a>
</div>
<div class="row map-background">
	<div class="col-md-2" id="select-menu">
	<div class="checkbox-container">
		<h4><u>Authorizing Statutes</u></h4>
		<div class="checkbox-div">
		  <input type="checkbox" class="checkbox-law" id="PA101-checkbox" value=""><label for="PA101-checkbox">Public Act 101 of 1988</label>
		</div><span>  </span>
		<div class="checkbox-div">
		  <input type="checkbox" class="checkbox-law" id="PA4-checkbox" value=""><label for="PA4-checkbox">Public Act 4 of 2011</label>
		</div><span>  </span>
		<div class="checkbox-div">
		  <input type="checkbox" class="checkbox-law" id="PA436-checkbox" value=""><label for="PA436-checkbox">Public Act 436 of 2012</label>
		</div>
	</div>
	<div class="checkbox-container">
		<h4><u>Consequences</u></h4>
		<div class="checkbox-div">
		  <input type="checkbox" class="checkbox-consequences" id="school-checkbox" value=""><label for="school-checkbox">Schools Closed</label>
		</div><span>  </span>
		<div class="checkbox-div">
		  <input type="checkbox" class="checkbox-consequences" id="pension-checkbox" value=""><label for="pension-checkbox">Pensions Defunded</label>
		</div><span>  </span>
		<div class="checkbox-div">
		  <input type="checkbox" class="checkbox-consequences" id="social-services-checkbox" value=""><label for="social-services-checkbox">Municipal Services Defunded/Outsourced</label>
		</div><span>  </span>
		<div class="checkbox-div">
		  <input type="checkbox" class="checkbox-consequences" id="social-services-checkbox" value=""><label for="social-services-checkbox">Municipal Staff Layoffs</label>
		</div><span>  </span>
		<div class="checkbox-div">
		  <input type="checkbox" class="checkbox-consequences" id="social-services-checkbox" value=""><label for="social-services-checkbox">Police/Fire Department Reduced or Eliminated</label>
		</div><span>  </span>
	</div>
<!-- Need to add heat maps on demographics -->
<!-- Need to add d3 graphs on demographics -->
<!-- Need to add info on race of emergency managers -->
<!-- Need to add lawsuit markers -->
<!-- Maybe graph looking at state overage during this time, see below -->
<!-- http://www.governing.com/topics/mgmt/gov-emergency-financial-managers-michigan-municipalities-unwelcome-savior.html -->
<!-- Some even blame Michigan for inflicting some of the pain Pontiac and other distressed cities are now experiencing. In early 2011, while promoting PA4, Snyder simultaneously advanced a budget eliminating one-third of the state revenue sharing set aside for localities -- about $307 million. That was on top of the $4 billion in state revenue that localities had lost over the last decade. While Pontiac struggles, the state ended last fiscal year with a reported $457 million surplus. That disparity has prompted some residents and elected officials to openly question whether Snyder’s budget, in concert with PA4, is an attempt by state leaders to systematically dismantle urban communities and promote a regionalized approach that favors counties. Schimmel’s immediate predecessor, Michael Stampfler, had suggested that the city consider filing for bankruptcy or being absorbed by Oakland County. The idea infuriated many residents, who viewed it as the state giving up on Pontiac. -->
	</div>
	<div class="col-md-10" id="display-panel">
		<div id="map"></div>
	</div>
</div>

<script type="text/javascript">

// https://stackoverflow.com/questions/16537326/leafletjs-how-to-remove-the-zoom-control
// Set zoomControl to true when splash screen closes
var map = L.map('map', {zoomControl: false}).setView([43.01,-83.69], 8);

$(document).ready(function(){
	$("#splashscreen").fadeIn("slow");

// https://stackoverflow.com/questions/426258/checking-a-checkbox-with-jquery
// https://stackoverflow.com/questions/10159214/why-does-dynamically-changing-a-checkbox-not-trigger-a-form-change-event
    $('#PA101-checkbox').prop('checked',true).trigger('change');
    $('#PA4-checkbox').prop('checked',true).trigger('change');
    $('#PA436-checkbox').prop('checked',true).trigger('change');
});

$('.enter_link').click(function() { 
    $(this).parent().fadeOut("slow");
    new L.Control.Zoom({ position: 'topleft' }).addTo(map)

 });
// https://github.com/dwilhelm89/LeafletSlider
	// Horizontal slider
	// $('#h-slider').slider({
	//     range: true,
	//     values: [17, 67]
	// });
	// var lansingCoordinates = [42.7336,-84.5467];
	var hamtramckCoordinates = [42.3978,-83.0572];
	var highlandParkCoordinates = [42.4036,-83.1017];
	var flintCoordinates = [43.01,-83.69];
	var threeOaksCoordinates = [41.7986,-86.6106];
	var detroitCoordinates = [42.3314,-83.0458];
	var ecorseCoordinates = [42.2444,-83.1458];
	var bentonHarborCoordinates = [42.1111,-86.4483];
	var pontiacCoordinates = [42.6461,-83.2925];
	var muskegonHeightsCoordinates = [43.2011,-86.2389];
	var allenParkCoordinates = [42.1111, 86.4483];

	var publicAct101FeatureCollection = {
		"type": "FeatureCollection",
		"features" : [
		{
		    "type": "Feature",
		    "properties": {
		        "name": "hamtramck1",
		        "locationName": "Hamtramck",
		        "actionsTaken": [],
		        "time": "1988-01-22 10:24:59+01",
		        "law": "Public Act, 1988",
		        "color": "red"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": hamtramckCoordinates
		    }
		},
		{
		    "type": "Feature",
		    "properties": {
		        "name": "hamtramck2",
		        "locationName": "Hamtramck",
		        "actionsTaken": [],
		        "time": "2000-01-22 10:24:59+01",
		        "law": "Public Act, 1988",
		        "color": "red"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": hamtramckCoordinates
		    }
		},
		{
		    "type": "Feature",
		    "properties": {
		        "name": "highLandPark1",
		        "locationName": "Highland Park",
		        "actionsTaken": [],
		        "time": "2000-01-22 10:24:59+01",
		        "color": "red"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": highlandParkCoordinates
		    }
		},
		{
		    "type": "Feature",
		    "properties": {
		        "name": "flint1",
		        "locationName": "Flint",
		        "actionsTaken": [],
		        "time": "2002-01-22 10:24:59+01",
		        "color": "red"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": flintCoordinates
		    }
		},
		{
		    "type": "Feature",
		    "properties": {
		        "name": "threeOaks1",
		        "locationName": "Three Oaks",
		        "actionsTaken": [],
		        "time": "2008-01-22 10:24:59+01",
		        "color": "red"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": threeOaksCoordinates
		    }
		},
		{
		    "type": "Feature",
		    "properties": {
		        "name": "detroit1",
		        "locationName": "Detroit",
		        "actionsTaken": [],
		        "time": "2009-01-22 10:24:59+01",
		        "color": "red"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": detroitCoordinates
		    }
		}]
	};

	var publicAct4FeatureCollection = {
		"type" : "FeatureCollection",
		"features": [{
		    "type": "Feature",
		    "properties": {
		        "name": "bentonHarbor",
		        "locationName": "Benton Harbor",
		        "actionsTaken": [],
		        "time": "2010-01-22 10:24:59+01",
		        "color": "blue"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": bentonHarborCoordinates
		    }
		},
		{
		    "type": "Feature",
		    "properties": {
		        "name": "pontiacHarbor",
		        "locationName": "Pontiac",
		        "actionsTaken": [],
		        "time": "2010-01-22 10:24:59+01",
		        "color": "blue"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": pontiacCoordinates
		    }
		},
		{
		    "type": "Feature",
		    "properties": {
		        "name": "flint2",
		        "locationName": "Flint",
		        "actionsTaken": [],
		        "time": "2011-01-22 10:24:59+01",
		        "color": "blue"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": flintCoordinates
		    }
		}]
	};

var publicAct436FeatureCollection = {
			"type":"FeatureCollection",
			"features": [{
		    "type": "Feature",
		    "properties": {
		        "name": "highlandPark2",
		        "locationName": "Highland Park",
		        "actionsTaken": [],
		        "time": "2012-01-22 10:24:59+01",
		        "color": "green"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": highlandParkCoordinates
		    }
		},
		{
		    "type": "Feature",
		    "properties": {
		        "name": "muskegonHeights1",
		        "locationName": "Muskegon Heights",
		        "actionsTaken": [],
		        "time": "2012-01-22 10:24:59+01",
		        "color": "green"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": muskegonHeightsCoordinates
		    }
		},
		{
		    "type": "Feature",
		    "properties": {
		        "name": "allenPark1",
		        "locationName": "Allen Park",
		        "actionsTaken": [],
		        "time": "2012-01-22 10:24:59+01",
		        "color": "green"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": allenParkCoordinates
		    }
		},
		{
		    "type": "Feature",
		    "properties": {
		        "name": "hamtramck3",
		        "locationName": "Hamtramck",
		        "actionsTaken": [],
		        "time": "2013-01-22 10:24:59+01",
		        "color": "green"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": hamtramckCoordinates
		    }
		},
		{
		    "type": "Feature",
		    "properties": {
		        "name": "bentonHarbor2",
		        "locationName": "Benton Harbor",
		        "actionsTaken": [],
		        "time": "2013-01-22 10:24:59+01",
		        "color": "green"
		    },
		    "geometry": {
		        "type": "Point",
		        "coordinates": bentonHarborCoordinates
		    }
		}]
	};

// Should break down the LineStrings into two separate vectors, and then assign each different styles.
// Something to consider for animations:
// https://gis.stackexchange.com/questions/29885/animated-lines-and-line-styles-in-javascript
// https://dynmeth.github.io/RaphaelLayer/
// https://gis.stackexchange.com/questions/26546/openlayers-animation-examples-and-algorithms
// http://raphaeljs.com/
// https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.png


	L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.png?access_token={accessToken}', {
	    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="http://mapbox.com">Mapbox</a>',
	    maxZoom: 18,
	    id: 'mapbox.satellite',
	    accessToken: 'pk.eyJ1Ijoic2hhd25vYWtsZXkiLCJhIjoiY2lqbTkzeGlrMDBhdXVmbHg0Z2Zzczl1YiJ9.rdTmbpwH0YTdD79RfXCd7w'
	}).addTo(map);


// http://stackexchange.vd-zr.ru/questions/178876/speeding-up-large-geojsons-in-leaflet-maps?&d=gis
	var testlayer = L.geoJson(publicAct101FeatureCollection).addData(publicAct4FeatureCollection).addData(publicAct436FeatureCollection);
// https://github.com/dwilhelm89/LeafletSlider
	var sliderControl = L.control.sliderControl({position: "topright", layer: testlayer, rezoom: 10, range: true});
	//Make sure to add the slider to the map ;-)
	map.addControl(sliderControl);

	//And initialize the slider
	sliderControl.startSlider();

	var publicAct101Icon = L.icon({
	    iconUrl: './assets/mapiconscollection-markers/aed-2.png',
	    shadowUrl: './assets/mapiconscollection-markers/aed-2.png',

	    iconSize:     [38, 95], // size of the icon
	    shadowSize:   [50, 64], // size of the shadow
	    iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
	    shadowAnchor: [4, 62],  // the same for the shadow
	    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
	});

	var publicAct4Icon = L.icon({
	    iconUrl: './assets/mapiconscollection-markers/360degrees.png',
	    shadowUrl: './assets/mapiconscollection-markers/360degrees.png',

	    iconSize:     [38, 95], // size of the icon
	    shadowSize:   [50, 64], // size of the shadow
	    iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
	    shadowAnchor: [4, 62],  // the same for the shadow
	    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
	});

	var publicAct436Icon = L.icon({
	    iconUrl: './assets/mapiconscollection-markers/2hand.png',
	    shadowUrl: './assets/mapiconscollection-markers/2hand.png',

	    iconSize:     [38, 95], // size of the icon
	    shadowSize:   [50, 64], // size of the shadow
	    iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
	    shadowAnchor: [4, 62],  // the same for the shadow
	    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
	});

	//And initialize the slider
	// sliderControl.startSlider();
	// var publicAct101Group = L.layerGroup([hamtramckMarker, highlandParkMarker, flintMarker, threeOaksMarker, detroitMarker, ecorseMarker]);
	// var publicAct4Group = L.layerGroup([bentonHarberMarker, pontiacMarker, flintMarker]);
	// var publicAct436Group = L.layerGroup([highlandParkMarker, muskegonHeightsMarker, allenParkMarker, hamtramckMarker, bentonHarberMarker]);


// https://stackoverflow.com/questions/6878757/how-to-listen-to-when-a-checkbox-is-checked-in-jquery
// 
// https://stackoverflow.com/questions/20751523/removing-leaflet-layers-and-l-marker-method

var publicAct4Group;
var publicAct436Group;
var publicAct101Group;

var publicAct4Array = [];
var publicAct436Array = [];
var publicAct101Array = [];

var markerLayerArray = [];
// Populat on document.ready using the below example.
// layerGroup = L.layerGroup([marker1, marker2, marker3, polyline ]);
// var sliderControl = L.control.sliderControl({layer:layerGroup});
// map.addControl(sliderControl);
// sliderControl.startSlider();

    $('#PA4-checkbox').change(function(){
    	if ($(this).is(':checked')) {
			publicAct4Group = L.geoJson(publicAct4FeatureCollection, {
			    style: function (feature) {
			        return {color: feature.properties.color};
			    },
			    onEachFeature: function (feature, layer) {
			    	var marker = L.marker(feature.geometry.coordinates, {icon: publicAct4Icon, bounceOnAdd: false})
			    	publicAct4Array.push(marker)
			    	markerLayerArray = 
			    	marker.addTo(map);
			        // layer.bindPopup(feature.properties.description);
			    }
			}).addTo(map);
    	} else {
      		console.log('pa4 uncheck');

			_.each(publicAct4Array, function(marker) {
				map.removeLayer(marker);
			});
			publicAct4Array = [];
    	}
    });
    $('#PA436-checkbox').change(function(){
    	if ($(this).is(':checked')) {
			publicAct436Group = L.geoJson(publicAct436FeatureCollection, {
			    style: function (feature) {
			        return {color: feature.properties.color};
			    },
			    onEachFeature: function (feature, layer) {
			    	var marker = L.marker(feature.geometry.coordinates, {icon: publicAct436Icon, bounceOnAdd: false})
			    	publicAct436Array.push(marker);
			    	marker.addTo(map);
			        // layer.bindPopup(feature.properties.description);
			    }
			}).addTo(map);
    	} else {
    		console.log('pa436 uncheck')
			// map.removeLayer(publicAct436Group);
			_.each(publicAct436Array, function(marker) {
				map.removeLayer(marker);
			});
			publicAct436Array = [];
    	}
    });

    $('#PA101-checkbox').change(function(){
    	if ($(this).is(':checked')) {
			publicAct101Group = L.geoJson(publicAct101FeatureCollection, {
			    style: function (feature) {
			        return {color: feature.properties.color};
			    },
			    onEachFeature: function (feature, layer) {
			    	var marker = L.marker(feature.geometry.coordinates, {icon: publicAct101Icon, bounceOnAdd: false});
			    	publicAct101Array.push(marker);
			    	marker.addTo(map);
			        // layer.bindPopup(feature.properties.description);
			    }
			}).addTo(map);
    	} else {
    		console.log('pa101 uncheck');
			// map.removeLayer(publicAct101Group);
			_.each(publicAct101Array, function(marker) {
				map.removeLayer(marker);
			});
			publicAct101Array = [];
    	}
    });

</script>
</body>

